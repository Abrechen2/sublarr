# Subtitle Scoring Algorithm

Sublarr scores every subtitle search result before downloading. Higher scores win.

---

## Base Score by Format

| Format | Base Score |
|---|---|
| ASS | 300 |
| SSA | 280 |
| SRT | 150 |
| VTT | 100 |
| Other | 50 |

ASS is scored highest because it preserves fansub styling (fonts, colors, typesetting) that SRT cannot represent.

---

## File Size Bonus

Larger subtitle files tend to have more lines and better coverage:

| File Size | Bonus |
|---|---|
| > 200 KB | +40 |
| > 100 KB | +30 |
| > 50 KB | +20 |
| ≤ 50 KB | +0 |

---

## Hash Match Bonus

If the subtitle's embedded release hash matches the video file's hash exactly:

| Match | Bonus |
|---|---|
| Exact hash match | +100 |
| No hash match | +0 |

A hash match is the strongest quality signal — it means the subtitle was made for exactly this encode.

---

## Metadata Bonuses

| Signal | Bonus |
|---|---|
| Series name match | +30 |
| Year match | +20 |
| Season match | +15 |
| Episode match | +15 |
| Release group match | +20 |
| ASS format (language profile pref) | +50 |

---

## Uploader Trust Bonus (Phase 24)

OpenSubtitles assigns uploaders a rank. Sublarr adds a trust bonus based on rank:

| Uploader Rank | Bonus |
|---|---|
| Gold/Diamond | +20 |
| Silver | +15 |
| Bronze | +10 |
| Unranked | +0 |

Top-ranked uploaders get an emerald badge in the UI.

---

## Machine Translation Penalty (Phase 23)

OpenSubtitles flags subtitles generated by machine translation with `mt` or `ai` tags. These receive a penalty:

| Flag | Penalty |
|---|---|
| `mt` or `ai` tag | -50 |

Machine-translated subtitles are shown with an orange badge. Users can still download them manually.

---

## Per-Provider Score Modifier

Each provider can have a manual score modifier (-100 to +100) set in Settings:

- Use positive modifiers for trusted providers
- Use negative modifiers for providers with historically poor quality

The modifier is applied after all other scoring.

---

## Score Cache

Scoring results are cached for 60 seconds. Changing the scoring configuration (weights, provider modifiers) invalidates the cache.

---

## Upgrade Scoring

When deciding whether to replace an existing subtitle, Sublarr compares scores:

### Format Rules

1. **Never downgrade** — ASS → SRT is blocked regardless of score
2. **Always upgrade format** — SRT → ASS always proceeds if `upgrade_prefer_ass = true`
3. **Same format** — only upgrade if score delta exceeds `upgrade_min_score_delta` (default: 50)

### Recency Protection

Subtitles downloaded within `upgrade_window_days` (default: 7 days) require **2x the minimum score delta**. This prevents rapid churn from flapping between similarly-scored providers.

### Existing File Score

The existing subtitle file is also scored:

```
ass file, 90KB → ASS(300) + size_bonus(30) = 330
srt file, 45KB → SRT(150) + size_bonus(0) = 150
```

Only a new subtitle with a sufficiently higher score wins.

---

## Final Score Formula

```
score = format_base
      + size_bonus
      + hash_match_bonus
      + series_bonus + year_bonus + season_bonus + episode_bonus
      + release_group_bonus
      + format_preference_bonus
      + uploader_trust_bonus
      - machine_translation_penalty
      + provider_modifier
```

The highest-scoring result above the minimum threshold is downloaded.

---

## Inspecting Scores

In the search results dialog (Library → Series → Episode → Search), each result shows its score breakdown. Use this to understand why a particular result was or was not chosen.
