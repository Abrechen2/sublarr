---
phase: 08-i18n-backup-admin-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/index.css
  - frontend/src/i18n/index.ts
  - frontend/src/i18n/locales/en/common.json
  - frontend/src/i18n/locales/de/common.json
  - frontend/src/hooks/useTheme.ts
  - frontend/src/components/shared/ThemeToggle.tsx
  - frontend/src/components/shared/LanguageSwitcher.tsx
  - frontend/index.html
  - frontend/src/main.tsx
autonomous: true

must_haves:
  truths:
    - "Dark theme looks identical to current app (no visual regression)"
    - "Light theme renders readable UI with correct contrast"
    - "Theme toggle switches between dark and light without page reload"
    - "Theme preference persists in localStorage across sessions"
    - "No flash of wrong theme on page load"
    - "i18n system initializes with English as default"
    - "Language switcher toggles between en and de"
    - "Language preference persists in localStorage across sessions"
  artifacts:
    - path: "frontend/src/index.css"
      provides: "Light theme in :root, dark theme in .dark, @custom-variant directive"
      contains: "@custom-variant dark"
    - path: "frontend/src/i18n/index.ts"
      provides: "i18next initialization with static JSON imports"
      exports: ["default"]
    - path: "frontend/src/i18n/locales/en/common.json"
      provides: "English translations for shared UI elements"
      contains: "nav"
    - path: "frontend/src/i18n/locales/de/common.json"
      provides: "German translations for shared UI elements"
      contains: "nav"
    - path: "frontend/src/hooks/useTheme.ts"
      provides: "Theme state management hook"
      exports: ["useTheme"]
    - path: "frontend/src/components/shared/ThemeToggle.tsx"
      provides: "Theme toggle button component"
      exports: ["ThemeToggle"]
    - path: "frontend/src/components/shared/LanguageSwitcher.tsx"
      provides: "Language toggle button component"
      exports: ["LanguageSwitcher"]
    - path: "frontend/index.html"
      provides: "Inline theme script preventing flash"
      contains: "sublarr-theme"
  key_links:
    - from: "frontend/src/index.css"
      to: "frontend/src/hooks/useTheme.ts"
      via: ".dark class toggle on document.documentElement"
      pattern: "classList\\.toggle.*dark"
    - from: "frontend/src/i18n/index.ts"
      to: "frontend/src/main.tsx"
      via: "import side-effect before App render"
      pattern: "import.*i18n"
    - from: "frontend/index.html"
      to: "localStorage"
      via: "inline script reads sublarr-theme"
      pattern: "sublarr-theme"
---

<objective>
Set up the theme system (dark/light toggle with CSS custom properties) and i18n infrastructure (react-i18next with static JSON imports) as foundations for Phase 8.

Purpose: These two systems are foundational -- the theme system changes CSS variable architecture, and i18n provides the translation framework that later plans will use to wrap all page strings.
Output: Working theme toggle, working language switcher, common.json files for en/de, no visual regression from current dark theme.
</objective>

<execution_context>
@C:/Users/Dennis Wittke/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Dennis Wittke/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-i18n-backup-admin-polish/08-RESEARCH.md
@frontend/src/index.css
@frontend/index.html
@frontend/src/main.tsx
@frontend/src/App.tsx
@frontend/src/components/layout/Sidebar.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Theme system -- CSS variables, useTheme hook, ThemeToggle component, flash-prevention script</name>
  <files>
    frontend/src/index.css
    frontend/src/hooks/useTheme.ts
    frontend/src/components/shared/ThemeToggle.tsx
    frontend/index.html
  </files>
  <action>
**index.css changes:**
1. Add `@custom-variant dark (&:where(.dark, .dark *));` immediately after `@import "tailwindcss";` line
2. Create NEW light theme values in `:root {}` -- move ALL current `:root` variable values into a new `.dark {}` block, then populate `:root` with light theme values. Use the EXACT light values from the research file (08-RESEARCH.md Pattern 4 / Light Theme CSS Variables section):
   - `--bg-primary: #f0f2f5`, `--bg-surface: #ffffff`, `--bg-surface-hover: #f5f7fa`, `--bg-elevated: #ffffff`
   - `--border: #e2e5eb`, `--border-hover: #d0d4dc`
   - `--text-primary: #1a1d26`, `--text-secondary: #5c6370`, `--text-muted: #9ca3b0`
   - `--accent: #0f9bb5` (slightly darker teal for contrast on white), `--accent-hover: #0d8aa1`, `--accent-dim: #0a7089`
   - `--accent-subtle: rgba(15, 155, 181, 0.08)`, `--accent-bg: rgba(15, 155, 181, 0.12)`
   - `--success: #22a55b`, `--success-bg: rgba(34, 165, 91, 0.1)`
   - `--error: #e5334b`, `--error-bg: rgba(229, 51, 75, 0.1)`
   - `--warning: #d48a08`, `--warning-bg: rgba(212, 138, 8, 0.1)`
3. The `.dark {}` block gets the CURRENT values that are in `:root` right now (no changes to dark theme appearance)
4. Typography vars (--font-body, --font-mono), radius vars, and body::before grid pattern should remain theme-independent in `:root` (they do not change between themes). For body::before grid, adjust the rgba alpha to work on both themes -- use `rgba(29, 184, 212, 0.025)` for light theme in `:root` and move the current value to `.dark` if different, OR keep it the same if subtle enough on both backgrounds.
5. Keep ALL animations, utility classes, scrollbar styles, card/button/input styles UNCHANGED -- they all use var() references already, so they auto-adapt.

**useTheme.ts:**
Create `frontend/src/hooks/useTheme.ts`:
- Export `useTheme()` hook returning `{ theme, setTheme }` where theme is `'dark' | 'light' | 'system'`
- Initialize from `localStorage.getItem('sublarr-theme')` -- default to `'dark'` if not set (maintaining current appearance)
- On theme change: toggle `.dark` class on `document.documentElement`, persist to localStorage
- For 'system' mode: check `window.matchMedia('(prefers-color-scheme: dark)')`, add listener for changes
- Use the exact pattern from research Pattern 5

**ThemeToggle.tsx:**
Create `frontend/src/components/shared/ThemeToggle.tsx`:
- Import Sun and Moon from lucide-react
- Three-state cycle: dark -> light -> system -> dark
- Show Moon icon for dark, Sun for light, Monitor (from lucide) for system
- Compact button (28x28px) suitable for sidebar footer placement
- Use `var(--text-secondary)` for icon color, `var(--accent)` on hover
- Tooltip or aria-label showing current mode name

**index.html:**
Add an inline `<script>` tag BEFORE the `<script type="module" src="/src/main.tsx">` line that reads `sublarr-theme` from localStorage and sets `.dark` class on `<html>` element synchronously. This prevents the flash-of-wrong-theme. Use the exact pattern from research "Theme Toggle Inline Script" section. Default to dark theme when no preference is stored.
  </action>
  <verify>
1. `cd frontend && npx tsc --noEmit` -- no TypeScript errors
2. `cd frontend && npm run build` -- builds successfully
3. Open app in browser: should look IDENTICAL to current (dark theme applied by default)
4. Inspect `<html>` element: should have `class="dark"` on load
  </verify>
  <done>
- Current dark theme appearance is preserved exactly (no visual regression)
- Light theme variables defined in :root, dark in .dark class
- useTheme hook manages theme state with localStorage persistence
- ThemeToggle component renders 3-state cycle button
- index.html inline script prevents flash of wrong theme
  </done>
</task>

<task type="auto">
  <name>Task 2: i18n infrastructure -- react-i18next setup, common namespace JSONs, LanguageSwitcher, Sidebar integration</name>
  <files>
    frontend/src/i18n/index.ts
    frontend/src/i18n/locales/en/common.json
    frontend/src/i18n/locales/de/common.json
    frontend/src/components/shared/LanguageSwitcher.tsx
    frontend/src/main.tsx
    frontend/src/components/layout/Sidebar.tsx
  </files>
  <action>
**Install dependencies first:**
```bash
cd frontend && npm install i18next react-i18next i18next-browser-languagedetector
```

**i18n/index.ts:**
Create `frontend/src/i18n/index.ts` following research Pattern 1:
- Import i18n from 'i18next', initReactI18next from 'react-i18next', LanguageDetector from 'i18next-browser-languagedetector'
- Static import common.json from both en and de locales
- Configure with: `fallbackLng: 'en'`, `defaultNS: 'common'`
- Namespace list: `['common', 'dashboard', 'settings', 'library', 'activity', 'logs', 'statistics', 'onboarding']`
- Detection config: `order: ['localStorage', 'navigator']`, `lookupLocalStorage: 'sublarr-language'`, `caches: ['localStorage']`
- `interpolation: { escapeValue: false }` (React handles escaping)
- For namespaces that don't have JSON files yet, i18next will fall back to the key -- this is fine, later plans add remaining namespace JSONs
- Export default i18n instance

**en/common.json:**
Create with the EXACT structure from research "i18n JSON Structure (English common.json)" section. This covers: nav (10 items), nav_groups (3 items), status (10 items), actions (14 items), theme (3 items), language (2 items). Additionally add:
- `"app": { "name": "Sublarr", "online": "Online", "offline": "Offline" }`
- `"pagination": { "showing": "Showing", "of": "of", "items": "items" }`
- `"time": { "just_now": "Just now", "minutes_ago": "{{count}} min ago", "hours_ago": "{{count}}h ago", "days_ago": "{{count}}d ago" }`
- `"confirm": { "title": "Are you sure?", "message": "This action cannot be undone.", "yes": "Yes", "no": "No" }`

**de/common.json:**
Create with the EXACT structure from research "i18n JSON Structure (German common.json)" section. Match all keys from en/common.json with proper German translations. For the additional keys:
- `"app": { "name": "Sublarr", "online": "Online", "offline": "Offline" }`
- `"pagination": { "showing": "Zeige", "of": "von", "items": "Eintraege" }`
- `"time": { "just_now": "Gerade eben", "minutes_ago": "Vor {{count}} Min.", "hours_ago": "Vor {{count}} Std.", "days_ago": "Vor {{count}} T." }`
- `"confirm": { "title": "Bist du sicher?", "message": "Diese Aktion kann nicht rueckgaengig gemacht werden.", "yes": "Ja", "no": "Nein" }`

**LanguageSwitcher.tsx:**
Create `frontend/src/components/shared/LanguageSwitcher.tsx`:
- Use `useTranslation()` hook from react-i18next
- Compact toggle button (similar style to ThemeToggle): shows "DE" when current language is en, "EN" when de
- On click: `i18n.changeLanguage(newLang)` -- detector auto-persists to localStorage
- Style: `var(--text-secondary)` text, `var(--accent)` on hover, 28px height, font-weight 600, font-size 11px

**main.tsx:**
Add `import './i18n'` BEFORE the App import (side-effect import that initializes i18next). This must be the first import after React.

**Sidebar.tsx:**
Add ThemeToggle and LanguageSwitcher to the sidebar footer area (next to the existing health status and version):
- Import ThemeToggle and LanguageSwitcher
- In the footer div (px-4 py-3 area), add a row ABOVE the health status line containing ThemeToggle and LanguageSwitcher side by side
- Use flex layout with gap-1.5, justify-end alignment
- Keep the existing health status + version row below unchanged
- Do NOT wrap sidebar text in t() yet -- that comes in Plan 04
  </action>
  <verify>
1. `cd frontend && npx tsc --noEmit` -- no TypeScript errors
2. `cd frontend && npm run build` -- builds successfully
3. Open app: sidebar footer shows theme toggle (moon icon) and language switcher ("DE" button)
4. Click theme toggle: cycles dark -> light -> system, UI colors change, persists on reload
5. Click language switcher: button text changes (EN <-> DE), `sublarr-language` appears in localStorage
  </verify>
  <done>
- i18next initialized with en/de common namespace via static JSON imports
- LanguageSwitcher component toggles language with localStorage persistence
- ThemeToggle and LanguageSwitcher visible in sidebar footer
- Theme switching works: dark (current look), light (new light values), system (follows OS)
- No visual regression when dark theme is active
- i18n ready for later plans to add namespace JSONs and wrap page strings
  </done>
</task>

</tasks>

<verification>
1. `cd frontend && npm run build` succeeds without errors
2. App loads with dark theme by default (visual match to pre-Phase-8 appearance)
3. Theme toggle cycles through dark/light/system with instant CSS variable swap
4. Language switcher toggles en/de, persisted in localStorage
5. No flash of wrong theme on hard page reload
6. Browser console shows no i18next warnings about missing keys (only common namespace loaded)
</verification>

<success_criteria>
- ADMN-03 (Dark/Light Theme): Toggle works, persists, no flash -- COMPLETE
- I18N-01 (react-i18next Setup): Namespaces configured, language detection works, persistence works -- COMPLETE
- Sidebar footer contains both controls
- All existing pages render correctly in dark mode (no regression)
- Light mode provides readable, professional appearance
</success_criteria>

<output>
After completion, create `.planning/phases/08-i18n-backup-admin-polish/08-01-SUMMARY.md`
</output>
