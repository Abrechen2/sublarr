---
phase: 24-uploader-trust-scoring
plan: 01
type: execute
wave: 1
depends_on: ["23-02"]
files_modified:
  - backend/providers/opensubtitles.py
  - backend/providers/base.py
  - backend/wanted_search.py
autonomous: true

must_haves:
  truths:
    - "For OpenSubtitles results, uploader trust score is fetched and incorporated as normalized bonus (0-20 points)"
    - "Uploader trust bonus is visible in search results alongside existing score breakdown"
    - "Non-OpenSubtitles providers are unaffected"
  artifacts:
    - path: "backend/providers/opensubtitles.py"
      provides: "Read attributes.uploader (uploader_id, name, rank); set uploader_trust on SubtitleResult"
    - path: "backend/providers/base.py"
      provides: "OpenSubtitles-specific bonus in compute_score (0-20 from uploader rank)"
    - path: "backend/wanted_search.py"
      provides: "_result_to_dict_interactive includes uploader_trust_bonus, uploader_name"
  key_links:
    - from: "backend/providers/opensubtitles.py"
      to: "SubtitleResult"
      via: "uploader_trust, uploader_name, uploader_rank"
    - from: "backend/providers/base.py"
      to: "compute_score"
      via: "uploader bonus only for OpenSubtitles results"
---

<objective>
Backend + Frontend: OpenSubtitles uploader trust score as 0-20 bonus in scoring; show in search results.

Purpose: Reward subtitles from trusted uploaders. OpenSubtitles API provides uploader (rank, name); normalize rank to 0-20 bonus; add to compute_score for OpenSubtitles only; expose in search response for UI.

Output: OpenSubtitles populates uploader_trust (from rank); compute_score adds bonus (0-20) for OpenSubtitles; _result_to_dict_interactive includes uploader_trust_bonus and uploader_name; frontend shows bonus in InteractiveSearchModal (same file as 23-02).
</objective>

<execution_context>
@C:/Users/Dennis Wittke/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Dennis Wittke/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md

@backend/providers/opensubtitles.py
@backend/providers/base.py
@backend/wanted_search.py
@frontend/src/components/wanted/InteractiveSearchModal.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: OpenSubtitles uploader data on SubtitleResult</name>
  <files>
    backend/providers/opensubtitles.py
  </files>
  <action>
1. In OpenSubtitles provider: from API response attributes.uploader read uploader_id, name, rank (or equivalent). Set on SubtitleResult: uploader_name (str), uploader_rank (int or str), and a normalized trust value for scoring (e.g. map rank to 0-20 scale). Document OpenSubtitles rank semantics if needed (e.g. higher = more trusted).
  </action>
  <verify>
    Fixture or test: response with uploader yields SubtitleResult with uploader fields; compute_score can read them.
  </verify>
  <done>
    OpenSubtitles results carry uploader_trust (0-20), uploader_name, uploader_rank.
  </done>
</task>

<task type="auto">
  <name>Task 2: Uploader bonus in compute_score</name>
  <files>
    backend/providers/base.py
  </files>
  <action>
1. In compute_score: when result.provider_name == "opensubtitles" and result has uploader_trust (or uploader_rank), add uploader_trust as bonus (0-20) to score. Non-OpenSubtitles results unchanged.
  </action>
  <verify>
    OpenSubtitles result with high trust gets +20; other providers unchanged.
  </verify>
  <done>
    compute_score adds 0-20 uploader bonus for OpenSubtitles only.
  </done>
</task>

<task type="auto">
  <name>Task 3: Expose in search response and frontend</name>
  <files>
    backend/wanted_search.py
    frontend/src/api/client.ts
    frontend/src/components/wanted/InteractiveSearchModal.tsx
  </files>
  <action>
1. _result_to_dict_interactive: add uploader_trust_bonus (number), uploader_name (string, optional) when present.
2. Frontend: extend InteractiveSearchResult type; in InteractiveSearchModal show uploader bonus (e.g. "+12" or "Trust +12") and optionally uploader name in tooltip or column.
  </action>
  <verify>
    Search response includes uploader_trust_bonus; modal shows it alongside score.
  </verify>
  <done>
    Search API and UI show uploader trust bonus; non-OpenSubtitles unaffected.
  </done>
</task>

</tasks>

<verification>
1. OpenSubtitles results have uploader_trust (0-20), uploader_name.
2. compute_score adds bonus for OpenSubtitles only; others unchanged.
3. Search response and UI show uploader bonus.
</verification>

<success_criteria>
- OpenSubtitles uploader trust is reflected as 0-20 bonus in score.
- Uploader bonus visible in search results; other providers unchanged.
</success_criteria>

<output>
After completion, create `.planning/phases/24-uploader-trust-scoring/24-01-SUMMARY.md`
</output>
