---
phase: 14-dashboard-widgets-quick-actions
plan: 02
type: execute
wave: 2
depends_on: ["14-01"]
files_modified:
  - frontend/package.json
  - frontend/src/components/quick-actions/QuickActionsFAB.tsx
  - frontend/src/components/quick-actions/KeyboardShortcutsModal.tsx
  - frontend/src/components/quick-actions/quickActionDefinitions.ts
  - frontend/src/hooks/useKeyboardShortcuts.ts
  - frontend/src/App.tsx
  - frontend/src/i18n/locales/en/common.json
  - frontend/src/i18n/locales/de/common.json
autonomous: true

must_haves:
  truths:
    - "User sees a floating action button (FAB) in the bottom-right corner on every page"
    - "Clicking the FAB expands a menu showing context-specific actions for the current page"
    - "Each action in the FAB menu shows its keyboard shortcut"
    - "Pressing keyboard shortcuts triggers the corresponding action without opening the FAB"
    - "Pressing Shift+/ (?) opens a modal listing all available keyboard shortcuts"
    - "Navigation shortcuts (g then d, g then l, g then w, g then s) work globally"
    - "Shortcuts do not fire when user is typing in an input field or textarea"
    - "FAB shows different actions depending on the current page route"
  artifacts:
    - path: "frontend/src/components/quick-actions/QuickActionsFAB.tsx"
      provides: "Floating action button with expandable context-specific action menu"
      exports: ["QuickActionsFAB"]
    - path: "frontend/src/components/quick-actions/KeyboardShortcutsModal.tsx"
      provides: "Modal listing all keyboard shortcuts grouped by category"
      exports: ["KeyboardShortcutsModal"]
    - path: "frontend/src/components/quick-actions/quickActionDefinitions.ts"
      provides: "Action definitions per route with labels, icons, shortcuts, handlers"
      exports: ["getActionTemplatesForRoute", "QuickActionTemplate", "GLOBAL_SHORTCUTS"]
    - path: "frontend/src/hooks/useKeyboardShortcuts.ts"
      provides: "Hook registering global navigation and help shortcuts"
      exports: ["useKeyboardShortcuts"]
    - path: "frontend/src/App.tsx"
      provides: "App shell with FAB and shortcuts modal integrated"
  key_links:
    - from: "frontend/src/App.tsx"
      to: "frontend/src/components/quick-actions/QuickActionsFAB.tsx"
      via: "JSX composition inside BrowserRouter"
      pattern: "<QuickActionsFAB"
    - from: "frontend/src/components/quick-actions/QuickActionsFAB.tsx"
      to: "frontend/src/components/quick-actions/quickActionDefinitions.ts"
      via: "getActionsForRoute import"
      pattern: "getActionTemplatesForRoute"
    - from: "frontend/src/hooks/useKeyboardShortcuts.ts"
      to: "react-hotkeys-hook"
      via: "useHotkeys hook"
      pattern: "useHotkeys"
    - from: "frontend/src/App.tsx"
      to: "frontend/src/hooks/useKeyboardShortcuts.ts"
      via: "hook invocation"
      pattern: "useKeyboardShortcuts"
---

<objective>
Create the Quick-Actions floating action button (FAB) and keyboard shortcuts system that provides context-specific actions on every page.

Purpose: Users can access common actions (scan library, search wanted, navigate pages) via a floating button or keyboard shortcuts without navigating through menus. This satisfies DASH-03 (Quick-Actions Toolbar) and DASH-04 (Context-Specific Actions).

Output: FAB component visible on all pages, keyboard shortcuts for navigation and page-specific actions, help modal showing all shortcuts.
</objective>

<execution_context>
@C:/Users/Dennis Wittke/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Dennis Wittke/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-dashboard-widgets-quick-actions/14-RESEARCH.md
@.planning/phases/14-dashboard-widgets-quick-actions/14-01-SUMMARY.md
@frontend/src/App.tsx
@frontend/src/hooks/useApi.ts
@frontend/src/i18n/locales/en/common.json
@frontend/src/i18n/locales/de/common.json
@frontend/package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install react-hotkeys-hook and create action definitions + keyboard shortcuts hook</name>
  <files>
    frontend/package.json
    frontend/src/components/quick-actions/quickActionDefinitions.ts
    frontend/src/hooks/useKeyboardShortcuts.ts
  </files>
  <action>
    1. Install react-hotkeys-hook:
       ```
       cd frontend && npm install react-hotkeys-hook
       ```

    2. Create `frontend/src/components/quick-actions/quickActionDefinitions.ts`:
       - Define `QuickActionTemplate` interface:
         ```typescript
         interface QuickActionTemplate {
           readonly id: string
           readonly labelKey: string        // i18n key in common namespace
           readonly icon: LucideIcon
           readonly shortcut: string         // Display string like "Shift+S"
           readonly hotkeyCombo: string      // react-hotkeys-hook format like "shift+s"
         }
         ```
       - Define per-route action templates:
         - **Dashboard** (`/`): Scan Library (RefreshCw, Shift+S), Search Wanted (Search, Shift+W)
         - **Wanted** (`/wanted`): Refresh Scan (RefreshCw, Shift+R), Search All (Search, Shift+S), Select All (CheckSquare, Shift+A)
         - **Library** (`/library`): Refresh Scan (RefreshCw, Shift+R)
         - **Series Detail** (`/library/series/:id`): Run Health Check (ShieldCheck, Shift+H)
         - **History** (`/history`): Select All (CheckSquare, Shift+A)
         - **default** (all other pages): no context-specific actions
       - Export `getActionTemplatesForRoute(pathname: string): QuickActionTemplate[]` that matches pathname against known routes using `startsWith` checks. For `/library/series/` use startsWith to match any series detail page.
       - Define `GLOBAL_SHORTCUTS` array of `{ id: string, labelKey: string, shortcut: string, category: string }` for documentation purposes (used by KeyboardShortcutsModal):
         - Navigation category: `g then d` -> Dashboard, `g then l` -> Library, `g then w` -> Wanted, `g then s` -> Settings, `g then a` -> Activity, `g then h` -> History
         - Global category: `Ctrl+K` -> Search, `Shift+/` -> Help/Shortcuts
       - Export `GLOBAL_SHORTCUTS`

    3. Create `frontend/src/hooks/useKeyboardShortcuts.ts`:
       - Import `useHotkeys` from `react-hotkeys-hook`
       - Import `useNavigate` from `react-router-dom`
       - Register global navigation shortcuts using `useHotkeys`:
         - `'g then d'` -> `navigate('/')` (Dashboard)
         - `'g then l'` -> `navigate('/library')` (Library)
         - `'g then w'` -> `navigate('/wanted')` (Wanted)
         - `'g then s'` -> `navigate('/settings')` (Settings)
         - `'g then a'` -> `navigate('/activity')` (Activity)
         - `'g then h'` -> `navigate('/history')` (History)
       - Accept `onToggleShortcutsModal: () => void` parameter
       - Register `'shift+/'` -> calls `onToggleShortcutsModal()` (the "?" shortcut)
       - All shortcuts: `enableOnFormTags: false` (default) to prevent firing in inputs
       - Wrap navigate calls with `void` operator for floating promise lint compliance
       - Export `useKeyboardShortcuts` hook
  </action>
  <verify>
    - `cd frontend && npx tsc --noEmit` passes without TypeScript errors
    - `react-hotkeys-hook` appears in frontend/package.json dependencies
    - Both files export their expected functions/types
  </verify>
  <done>
    react-hotkeys-hook installed. Action definitions define per-route action templates for 6 page contexts. Global keyboard shortcuts hook registers navigation (g then d/l/w/s/a/h) and help (Shift+/) shortcuts. All TypeScript compiles.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create FAB component, shortcuts modal, integrate into App.tsx, add i18n</name>
  <files>
    frontend/src/components/quick-actions/QuickActionsFAB.tsx
    frontend/src/components/quick-actions/KeyboardShortcutsModal.tsx
    frontend/src/App.tsx
    frontend/src/i18n/locales/en/common.json
    frontend/src/i18n/locales/de/common.json
  </files>
  <action>
    1. Create `frontend/src/components/quick-actions/QuickActionsFAB.tsx`:
       - Floating button fixed to bottom-right corner: `fixed bottom-6 right-6 z-50`
       - Main button: 48x48 circle with `var(--accent)` background, white Plus icon (24px)
       - On click: toggles `open` state. When open, button rotates 45 degrees (Plus becomes X)
       - When open: renders action items above the button with staggered fade-in animation
       - Each action item: pill-shaped button with icon, label, and keyboard shortcut badge
       - Action items styled with `var(--bg-elevated)`, `var(--border)`, subtle shadow
       - Shortcut badge uses `<kbd>` element with monospace font, small background
       - Clicking an action: calls handler, closes FAB
       - Click outside to close: add a transparent overlay div when open
       - Uses `useLocation()` from react-router-dom to get current pathname
       - Calls `getActionTemplatesForRoute(pathname)` to get templates
       - For handler injection: define a `useQuickActionHandlers()` hook inside the FAB file that imports and calls the necessary hooks (useRefreshWanted, useStartWantedBatch, useSelectionStore, etc.) and returns a `Map<string, () => void>` mapping action template IDs to handler functions.
       - Register page-specific hotkeys using `useHotkeys` from react-hotkeys-hook for each action in the current route's action list
       - Hide FAB entirely when no actions available for current route
       - Use `useTranslation('common')` for labels
       - Add CSS keyframes for `fadeSlideUp` animation inline or via a `<style>` tag:
         ```css
         @keyframes fadeSlideUp {
           from { opacity: 0; transform: translateY(8px); }
           to { opacity: 1; transform: translateY(0); }
         }
         ```
       - Export as named export `QuickActionsFAB`

    2. Create `frontend/src/components/quick-actions/KeyboardShortcutsModal.tsx`:
       - Props: `open: boolean`, `onClose: () => void`
       - Modal overlay with dark backdrop (match existing modal patterns)
       - Title: "Keyboard Shortcuts" (i18n: `common:shortcuts.title`)
       - Group shortcuts by category:
         - **Navigation**: g+d Dashboard, g+l Library, g+w Wanted, g+s Settings, g+a Activity, g+h History
         - **Global**: Ctrl+K Search, Shift+/ Help
         - **Page Actions**: dynamic list from `getActionTemplatesForRoute` for current route (use `useLocation()`)
       - Each shortcut row: description on left, `<kbd>` badge on right
       - Close on Escape key or overlay click
       - Use CSS variables for theming
       - Export as named export `KeyboardShortcutsModal`

    3. Modify `frontend/src/App.tsx`:
       - Add state: `shortcutsModalOpen: boolean` (default false)
       - Import `QuickActionsFAB` and `KeyboardShortcutsModal` -- use regular imports (not lazy) since they are small and always needed
       - Import `useKeyboardShortcuts` hook
       - Create a new `GlobalShortcuts` component (inside App.tsx):
         - Calls `useKeyboardShortcuts({ onToggleShortcutsModal })` inside BrowserRouter context (needs useNavigate)
         - Returns null (no UI)
       - Render inside `<BrowserRouter>`:
         - `<GlobalShortcuts />` (after GlobalWebSocketListener)
         - `<QuickActionsFAB />` (after ToastContainer, inside BrowserRouter so it has router context)
         - `<KeyboardShortcutsModal open={shortcutsModalOpen} onClose={...} />`
       - IMPORTANT: Keep the existing Ctrl+K handler (lines 99-108) as-is. Do NOT re-register it in useKeyboardShortcuts to avoid double-fire. The existing manual handler works correctly with GlobalSearchModal.
       - Pass `shortcutsModalOpen` state down via props or manage it at the App level

    4. Update `frontend/src/i18n/locales/en/common.json`:
       - Add `"shortcuts"` section:
         ```json
         "shortcuts": {
           "title": "Keyboard Shortcuts",
           "navigation": "Navigation",
           "global": "Global",
           "page_actions": "Page Actions",
           "go_dashboard": "Go to Dashboard",
           "go_library": "Go to Library",
           "go_wanted": "Go to Wanted",
           "go_settings": "Go to Settings",
           "go_activity": "Go to Activity",
           "go_history": "Go to History",
           "search": "Global Search",
           "help": "Show Shortcuts",
           "no_page_actions": "No shortcuts for this page"
         }
         ```
       - Add `"quick_actions"` section:
         ```json
         "quick_actions": {
           "scan_library": "Scan Library",
           "search_wanted": "Search Wanted",
           "refresh_scan": "Refresh Scan",
           "search_all": "Search All",
           "select_all": "Select All",
           "health_check": "Health Check",
           "no_actions": "No actions for this page"
         }
         ```

    5. Update `frontend/src/i18n/locales/de/common.json`:
       - Add matching `"shortcuts"` section:
         ```json
         "shortcuts": {
           "title": "Tastenkuerzel",
           "navigation": "Navigation",
           "global": "Global",
           "page_actions": "Seitenaktionen",
           "go_dashboard": "Zum Dashboard",
           "go_library": "Zur Bibliothek",
           "go_wanted": "Zu Gesucht",
           "go_settings": "Zu Einstellungen",
           "go_activity": "Zur Aktivitaet",
           "go_history": "Zum Verlauf",
           "search": "Globale Suche",
           "help": "Kuerzel anzeigen",
           "no_page_actions": "Keine Kuerzel fuer diese Seite"
         }
         ```
       - Add matching `"quick_actions"` section:
         ```json
         "quick_actions": {
           "scan_library": "Bibliothek scannen",
           "search_wanted": "Gesuchte durchsuchen",
           "refresh_scan": "Scan aktualisieren",
           "search_all": "Alle durchsuchen",
           "select_all": "Alle auswaehlen",
           "health_check": "Qualitaetspruefung",
           "no_actions": "Keine Aktionen fuer diese Seite"
         }
         ```
  </action>
  <verify>
    - `cd frontend && npx tsc --noEmit` passes without TypeScript errors
    - `cd frontend && npm run build` completes successfully
    - App.tsx renders QuickActionsFAB and KeyboardShortcutsModal
    - All i18n keys exist in both en and de locale files
  </verify>
  <done>
    QuickActionsFAB renders on every page with context-specific actions. KeyboardShortcutsModal opens with Shift+/ showing all shortcuts grouped by category. Navigation shortcuts (g then d/l/w/s/a/h) navigate between pages. Page-specific shortcuts trigger actions without opening the FAB. Shortcuts do not fire in input fields. Build compiles cleanly. i18n strings for both EN and DE are complete.
  </done>
</task>

</tasks>

<verification>
1. Run `cd frontend && npm run build` -- build completes without errors
2. Run `cd frontend && npx tsc --noEmit` -- type checking passes
3. Manual verification: FAB button visible in bottom-right corner on Dashboard, Library, Wanted pages
4. Manual verification: Clicking FAB opens action menu with labeled shortcuts
5. Manual verification: Pressing Shift+/ opens the keyboard shortcuts help modal
6. Manual verification: Pressing g then d navigates to Dashboard from any page
7. Manual verification: Shortcuts do NOT fire when typing in the global search (Ctrl+K) input
8. Manual verification: FAB hides on pages without context-specific actions (e.g. Logs, Statistics)
</verification>

<success_criteria>
- FAB is visible and functional on every page that has context-specific actions
- Context-specific actions change based on current route (at least 4 different contexts)
- Keyboard shortcuts modal lists all shortcuts grouped by Navigation, Global, and Page Actions
- Global navigation shortcuts (g then d/l/w/s/a/h) work from any page
- No shortcuts fire when user is focused on input/textarea elements
- No TypeScript errors, clean build
- EN and DE i18n translations complete for all new strings
</success_criteria>

<output>
After completion, create `.planning/phases/14-dashboard-widgets-quick-actions/14-02-SUMMARY.md`
</output>
