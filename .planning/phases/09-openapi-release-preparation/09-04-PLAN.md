---
phase: 09-openapi-release-preparation
plan: 04
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - backend/routes/profiles.py
  - backend/routes/blacklist.py
  - backend/routes/hooks.py
  - backend/routes/standalone.py
  - backend/routes/mediaservers.py
  - backend/routes/whisper.py
  - backend/routes/plugins.py
  - backend/routes/webhooks.py
  - backend/routes/tools.py
  - frontend/src/pages/Tasks.tsx
  - frontend/src/components/layout/Sidebar.tsx
  - frontend/src/lib/types.ts
  - frontend/src/hooks/useApi.ts
  - frontend/src/App.tsx
  - frontend/src/i18n/en/common.json
  - frontend/src/i18n/de/common.json
autonomous: true

must_haves:
  truths:
    - "All 120+ API endpoints across all 15 blueprints have OpenAPI YAML docstrings"
    - "Tasks page shows background scheduler status (wanted scan, wanted search, backup) with last run time and controls"
    - "Tasks page is accessible from Sidebar navigation and lazy-loaded via React.lazy"
  artifacts:
    - path: "frontend/src/pages/Tasks.tsx"
      provides: "Task scheduler dashboard showing background job status"
      contains: "export"
    - path: "backend/routes/hooks.py"
      provides: "OpenAPI docstrings for hooks/webhooks/scoring endpoints"
      contains: "---"
    - path: "backend/routes/standalone.py"
      provides: "OpenAPI docstrings for standalone mode endpoints"
      contains: "---"
  key_links:
    - from: "frontend/src/pages/Tasks.tsx"
      to: "backend/routes/system.py"
      via: "GET /api/v1/tasks endpoint"
      pattern: "tasks"
    - from: "frontend/src/App.tsx"
      to: "frontend/src/pages/Tasks.tsx"
      via: "React.lazy import and Route definition"
      pattern: "Tasks"
---

<objective>
Complete OpenAPI documentation for all remaining 9 blueprints (MEDIUM/LOW priority) and create the Tasks page showing background scheduler status with run/stop controls.

Purpose: Full API documentation coverage is a release requirement (OAPI-01). The Tasks page (OAPI-06) gives users visibility into background operations and the ability to trigger manual scans/searches.

Output: YAML docstrings on remaining ~54 endpoints, Tasks page component, /tasks route in sidebar.
</objective>

<execution_context>
@C:/Users/Dennis Wittke/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Dennis Wittke/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-openapi-release-preparation/09-RESEARCH.md
@.planning/phases/09-openapi-release-preparation/09-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add OpenAPI YAML docstrings to remaining 9 blueprints</name>
  <files>
    backend/routes/profiles.py
    backend/routes/blacklist.py
    backend/routes/hooks.py
    backend/routes/standalone.py
    backend/routes/mediaservers.py
    backend/routes/whisper.py
    backend/routes/plugins.py
    backend/routes/webhooks.py
    backend/routes/tools.py
  </files>
  <action>
Add YAML docstrings to all view functions in the remaining 9 blueprints, following the same pattern established in Plan 01 Task 2.

**Blueprint-specific guidance:**

**profiles.py (~12 endpoints):** Tags: Profiles. Covers language profiles CRUD, glossary management, prompt presets. Key endpoints: GET/POST /language-profiles, PUT/DELETE /language-profiles/{id}, GET/POST /glossary, GET/POST /presets.

**blacklist.py (~7 endpoints):** Tags: Blacklist. Covers subtitle blacklist CRUD. Key endpoints: GET /blacklist (paginated), POST /blacklist, DELETE /blacklist/{id}, DELETE /blacklist/clear.

**hooks.py (~17 endpoints):** Tags: Events. Covers event hooks (shell scripts), outgoing webhooks, scoring config. Key endpoints: GET/POST /hooks, GET/POST /webhooks, GET /scoring/weights, PUT /scoring/weights, GET/PUT /scoring/modifiers.

**standalone.py (~12 endpoints):** Tags: Standalone. Covers standalone mode operations. Key endpoints: GET /standalone/status, GET /standalone/series, GET /standalone/movies, POST /standalone/scan, GET/POST /standalone/folders.

**mediaservers.py (~5 endpoints):** Tags: MediaServers. Covers media server instance management. Key endpoints: GET /mediaservers/instances, PUT /mediaservers/instances, POST /mediaservers/test, GET /mediaservers/types.

**whisper.py (~10 endpoints):** Tags: Whisper. Covers Whisper backend configuration and transcription queue. Key endpoints: GET /whisper/status, GET /whisper/backends, PUT /whisper/config, GET /whisper/queue, POST /whisper/transcribe.

**plugins.py (~4 endpoints):** Tags: Plugins. Covers plugin management. Key endpoints: GET /plugins, POST /plugins/reload, GET /plugins/{name}.

**webhooks.py (~2 endpoints):** Tags: Webhooks. Covers incoming Sonarr/Radarr webhooks. Key endpoints: POST /webhook/sonarr, POST /webhook/radarr. Document the expected webhook payload structure from Sonarr/Radarr.

**tools.py (~4 endpoints):** Tags: Tools. Covers subtitle utility tools. Key endpoints: POST /tools/timing-adjust, POST /tools/encoding-fix, POST /tools/hi-removal, POST /tools/style-strip.

Same rules as Plan 01: Do NOT modify function logic. Only add/modify docstrings. Use consistent YAML indentation. Include tags, summary, parameters, request body (where applicable), and response status codes.
  </action>
  <verify>
Run: `cd backend && python -c "
from app import create_app
app = create_app()
client = app.test_client()
resp = client.get('/api/v1/openapi.json')
data = resp.get_json()
paths = data.get('paths', {})
tags_found = set()
for path_info in paths.values():
    for method_info in path_info.values():
        if isinstance(method_info, dict):
            tags_found.update(method_info.get('tags', []))
print(f'Total paths: {len(paths)}')
print(f'Tags: {sorted(tags_found)}')
expected_tags = ['System', 'Translate', 'Providers', 'Wanted', 'Library', 'Config', 'Profiles', 'Blacklist', 'Events', 'Standalone', 'MediaServers', 'Whisper', 'Plugins', 'Webhooks', 'Tools']
missing = [t for t in expected_tags if t not in tags_found]
print(f'Missing tags: {missing}')
assert len(paths) >= 90, f'Expected 90+ paths, got {len(paths)}'
print('OK: 90+ paths documented')
"`

Expected: 90+ paths documented, all 15 tags present.
  </verify>
  <done>
  - All remaining 9 blueprints have YAML docstrings on every endpoint
  - Total spec paths >= 90 (covering all 120+ endpoints minus utility/static routes)
  - All 15 tags present in the spec (one per blueprint)
  - No functional code changes
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Tasks page with scheduler status and controls</name>
  <files>
    frontend/src/pages/Tasks.tsx
    frontend/src/components/layout/Sidebar.tsx
    frontend/src/lib/types.ts
    frontend/src/hooks/useApi.ts
    frontend/src/App.tsx
    frontend/src/i18n/en/common.json
    frontend/src/i18n/de/common.json
  </files>
  <action>
Create a Tasks page that shows background scheduler status and provides manual trigger controls.

1. **Add TypeScript types to `frontend/src/lib/types.ts`:**
   ```typescript
   export interface SchedulerTask {
     name: string
     display_name: string
     running: boolean
     last_run: string | null
     next_run: string | null
     interval_hours: number | null
     enabled: boolean
   }

   export interface TasksResponse {
     tasks: SchedulerTask[]
   }
   ```

2. **Add API hook to `frontend/src/hooks/useApi.ts`:**
   - `useTasks()` -- fetches GET /api/v1/tasks with auto-refresh every 10 seconds
   - `useTriggerTask()` -- POST mutation to trigger a specific task (e.g., POST /wanted/refresh, POST /wanted/batch-search)

3. **Ensure the GET /api/v1/tasks endpoint exists** -- it was specified in Plan 02 Task 2 as part of the scheduler subsystem in /health/detailed. If it doesn't exist as a standalone endpoint, the Tasks page can use the scheduler data from /health/detailed. Either approach works. If a dedicated /tasks endpoint needs creation, add it to routes/system.py here (with OpenAPI docstring).

4. **Create `frontend/src/pages/Tasks.tsx`:**
   - Card-based layout showing each background task
   - Each task card shows:
     - Task name (display_name)
     - Status indicator (running = green pulse, idle = gray)
     - Last run timestamp (relative time, e.g., "5 minutes ago")
     - Next scheduled run (if interval-based)
     - Interval (e.g., "Every 6 hours")
     - Action buttons: "Run Now" (triggers manual execution), shown only when not running
   - Task list should include at minimum:
     - Wanted Scan (triggers /wanted/refresh)
     - Wanted Search (triggers /wanted/batch-search)
     - Backup (triggers /backup/create)
   - Use the *arr-style teal theme consistent with other pages
   - Show a loading skeleton while data loads
   - Include useTranslation for i18n (English + German)

5. **Add route to `frontend/src/App.tsx`:**
   - Add lazy import: `const TasksPage = lazy(() => import('@/pages/Tasks').then(m => ({ default: m.TasksPage })))`
   - Add Route: `<Route path="/tasks" element={<TasksPage />} />`

6. **Add to Sidebar navigation (`frontend/src/components/layout/Sidebar.tsx`):**
   - Add "Tasks" link in the System nav group (alongside Settings, Statistics, Logs)
   - Use Clock or ListChecks icon from lucide-react
   - Path: "/tasks"

7. **Add i18n strings:**
   - Add `tasks` keys to `frontend/src/i18n/en/common.json` and `frontend/src/i18n/de/common.json`
   - Keys: tasks.title, tasks.runNow, tasks.running, tasks.idle, tasks.lastRun, tasks.nextRun, tasks.interval, tasks.noTasks
  </action>
  <verify>
Run: `cd frontend && npx tsc --noEmit && npm run build 2>&1 | tail -5`

Expected: TypeScript compiles. Build succeeds. Tasks.tsx chunk appears in build output.

Check sidebar: `grep -c "tasks" frontend/src/components/layout/Sidebar.tsx` -- should find task-related entries.
  </verify>
  <done>
  - Tasks.tsx page created with scheduler status cards and "Run Now" controls
  - TypeScript types for SchedulerTask and TasksResponse in types.ts
  - API hooks for fetching tasks and triggering manual runs
  - Tasks route added to App.tsx with lazy loading
  - Tasks link added to Sidebar navigation
  - i18n strings added for EN and DE
  - Build succeeds with Tasks chunk
  </done>
</task>

</tasks>

<verification>
1. /api/v1/openapi.json has 90+ documented paths with all 15 blueprint tags
2. Swagger UI at /api/docs shows all endpoints organized by tags
3. Tasks page loads at /tasks, shows background scheduler status
4. "Run Now" button triggers manual scan/search
5. `cd frontend && npm run build` and `cd backend && python -m pytest tests/ -x -q` both pass
</verification>

<success_criteria>
- Full OpenAPI coverage: all 120+ endpoints documented across 15 blueprints
- Tasks page shows scheduler status with last run time, interval, and manual trigger buttons
- Tasks page integrated into navigation and lazy-loaded
</success_criteria>

<output>
After completion, create `.planning/phases/09-openapi-release-preparation/09-04-SUMMARY.md`
</output>
