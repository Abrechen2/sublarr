---
phase: 19-context-window-batching
plan: 02
type: execute
wave: 2
depends_on: ["19-01"]
files_modified:
  - frontend/src/pages/Settings/TranslationTab.tsx
  - frontend/src/api/client.ts
  - frontend/src/hooks/useApi.ts
autonomous: false

must_haves:
  truths:
    - "User can set Context window (lines) 0-10 in Settings Translation tab"
    - "Setting is persisted and loaded via API (config_entry translation.context_window_size)"
    - "Default shown when unset is 3"
  artifacts:
    - path: "frontend/src/pages/Settings/TranslationTab.tsx"
      provides: "Context window size number input in Translation settings"
    - path: "frontend/src/api/client.ts"
      provides: "getConfigEntry / saveConfigEntry or equivalent for translation.context_window_size"
    - path: "frontend/src/hooks/useApi.ts"
      provides: "Hook to load/save context window setting"
  key_links:
    - from: "frontend/src/pages/Settings/TranslationTab.tsx"
      to: "frontend/src/hooks/useApi.ts"
      via: "useContextWindowConfig or config hook"
    - from: "frontend"
      to: "/api/v1/config or /config/entries"
      via: "GET/PUT for translation.context_window_size"
---

<objective>
Frontend: Settings UI for context window size (0-10 lines, default 3).

Purpose: Users configure how many preceding/following subtitle lines are sent as context to the LLM. Stored as config_entry translation.context_window_size.

Output: Number input in Settings > Translation; load/save via existing config API; validation 0-10.
</objective>

<execution_context>
@C:/Users/Dennis Wittke/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Dennis Wittke/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-context-window-batching/19-RESEARCH.md
@.planning/phases/19-context-window-batching/19-CONTEXT.md
@.planning/phases/19-context-window-batching/19-01-SUMMARY.md

@frontend/src/pages/Settings/TranslationTab.tsx
@frontend/src/api/client.ts
@frontend/src/hooks/useApi.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: API client and hooks for context window config</name>
  <files>
    frontend/src/api/client.ts
    frontend/src/hooks/useApi.ts
  </files>
  <action>
1. Use existing config API if present: GET/PUT for config entries (e.g. GET /config, PUT /config with key translation.context_window_size). If no generic config API exists, add getConfigEntry(key) and saveConfigEntry(key, value) (or extend existing config functions).
2. Add hook e.g. useContextWindowSize(): query key translation.context_window_size, default 3; mutation to save. Invalidate on save.
  </action>
  <verify>
    Run: `cd frontend && npx tsc --noEmit` and `npm run lint`.
  </verify>
  <done>
    API can read/write translation.context_window_size; hook exposes value and save with default 3.
  </done>
</task>

<task type="auto">
  <name>Task 2: Context window UI in Translation tab</name>
  <files>
    frontend/src/pages/Settings/TranslationTab.tsx
  </files>
  <action>
1. In Settings > Translation tab, add a "Context window (lines)" control: number input, min 0, max 10, default 3. Short help text: "Number of lines before and after each batch sent as context to the LLM. 0 = disabled."
2. Place alongside other translation settings (e.g. near prompt presets or backends). Save on blur or explicit Save button consistent with the rest of the tab.
  </action>
  <verify>
    Run: `cd frontend && npx tsc --noEmit` and `npm run build`. Manually: change value, reload, confirm value persists.
  </verify>
  <done>
    Translation tab shows Context window (lines) 0-10; value persists after save and reload.
  </done>
</task>

</tasks>

<verification>
1. Settings Translation tab has Context window (lines) input 0-10, default 3.
2. Value is loaded from and saved to config (translation.context_window_size).
3. TypeScript and build succeed.
</verification>

<success_criteria>
- User can configure context window size from Settings > Translation.
- Value 0-10 is validated and persisted.
- No regression in existing Translation settings.
</success_criteria>

<output>
After completion, create `.planning/phases/19-context-window-batching/19-02-SUMMARY.md`
</output>
