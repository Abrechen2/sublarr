---
phase: 16-external-integrations
plan: 03
type: execute
wave: 2
depends_on: ["16-01", "16-02"]
files_modified:
  - frontend/src/pages/Settings/IntegrationsTab.tsx
  - frontend/src/pages/Settings/index.tsx
  - frontend/src/api/client.ts
  - frontend/src/hooks/useApi.ts
  - frontend/src/lib/types.ts
  - frontend/src/i18n/locales/en/settings.json
  - frontend/src/i18n/locales/de/settings.json
autonomous: true

must_haves:
  truths:
    - "User can view Bazarr mapping report from Settings Integrations tab"
    - "User can run Plex or Kodi compatibility check on their subtitle files"
    - "User can view extended health diagnostics for all configured services"
    - "User can export config in Bazarr, Plex, Kodi, or generic JSON format"
    - "User can download a ZIP bundle of all export formats"
  artifacts:
    - path: "frontend/src/pages/Settings/IntegrationsTab.tsx"
      provides: "Integrations settings tab with migration, compat, health, export UI"
      contains: "IntegrationsTab"
    - path: "frontend/src/api/client.ts"
      provides: "API client functions for all integration endpoints"
      contains: "getExtendedHealth"
    - path: "frontend/src/lib/types.ts"
      provides: "TypeScript interfaces for integration responses"
      contains: "ExtendedHealthCheck"
  key_links:
    - from: "frontend/src/pages/Settings/IntegrationsTab.tsx"
      to: "frontend/src/api/client.ts"
      via: "useApi hooks calling integration endpoints"
      pattern: "useIntegrations|getExtendedHealth|getBazarrMappingReport"
    - from: "frontend/src/pages/Settings/index.tsx"
      to: "frontend/src/pages/Settings/IntegrationsTab.tsx"
      via: "tab import and TABS array"
      pattern: "IntegrationsTab"
---

<objective>
Create the frontend IntegrationsTab in Settings with UI sections for Bazarr migration mapping report, Plex/Kodi compatibility checking, extended health diagnostics for all services, and multi-format config export.

Purpose: Users can access all integration features from a unified Settings tab.
Output: IntegrationsTab.tsx component, TypeScript types, API client functions, useApi hooks, i18n translations.
</objective>

<execution_context>
@C:/Users/Dennis Wittke/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Dennis Wittke/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-external-integrations/16-RESEARCH.md
@.planning/phases/16-external-integrations/16-01-SUMMARY.md
@.planning/phases/16-external-integrations/16-02-SUMMARY.md
@frontend/src/pages/Settings/index.tsx
@frontend/src/api/client.ts
@frontend/src/hooks/useApi.ts
@frontend/src/lib/types.ts
@frontend/src/i18n/locales/en/settings.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add TypeScript types, API client functions, and useApi hooks for integrations</name>
  <files>
    frontend/src/lib/types.ts
    frontend/src/api/client.ts
    frontend/src/hooks/useApi.ts
  </files>
  <action>
**types.ts** -- Add these interfaces at the end of the file:

ExtendedHealthCheck: {
  connection: {healthy: boolean, message: string}
  api_version?: {version: string, branch: string, app_name: string}
  server_info?: {server_name?: string, friendly_name?: string, version: string, product_name?: string, platform?: string, os?: string, name?: string, jsonrpc_version?: string}
  library_access: {series_count?: number, movie_count?: number, library_count?: number, section_count?: number, video_sources_count?: number, accessible: boolean, libraries?: Array<{name: string, collectionType?: string}>, sections?: Array<{title: string, type: string}>, video_sources?: Array<{label: string}>}
  webhook_status?: {configured: boolean, sublarr_webhooks: Array<{name: string}>}
  health_issues: Array<{type: string, message: string}>
}

ExtendedHealthAllResponse: {
  sonarr: Array<{name: string} & ExtendedHealthCheck>
  radarr: Array<{name: string} & ExtendedHealthCheck>
  jellyfin: ExtendedHealthCheck | null
  media_servers: Array<{name: string, type: string} & ExtendedHealthCheck>
}

BazarrMappingReport: {
  tables_found: string[]
  table_details: Record<string, {row_count: number, columns: string[], sample_row: Record<string, unknown> | null}>
  migration_summary: {profiles_count: number, blacklist_count: number, shows_count: number, movies_count: number, history_count: number, has_sonarr_config: boolean, has_radarr_config: boolean}
  compatibility: {bazarr_version: string | null, schema_version: string | null}
  warnings: string[]
}

CompatCheckResult: {
  compatible: boolean
  issues: string[]
  warnings: string[]
  recommendations: string[]
}

CompatBatchResult: {
  results: Array<{path: string} & CompatCheckResult>
  summary: {total: number, compatible: number, incompatible: number}
}

ExportResult: {
  format: string
  data: unknown
  filename: string
  content_type: string
  warnings: string[]
}

**client.ts** -- Add these API functions:

getBazarrMappingReport(dbPath: string) -> POST /integrations/bazarr/mapping-report body {db_path: dbPath}
runCompatCheck(subtitlePaths: string[], videoPath: string, target: string) -> POST /integrations/compat-check body {subtitle_paths, video_path, target}
runSingleCompatCheck(subtitlePath: string, videoPath: string, target: string) -> POST /integrations/compat-check/single body {subtitle_path, video_path, target}
getExtendedHealthAll() -> GET /integrations/health/all
exportConfig(format: string, includeSecrets: boolean) -> POST /integrations/export body {format, include_secrets}
exportConfigZip(formats: string[], includeSecrets: boolean) -> POST /integrations/export/zip body {formats, include_secrets} with responseType: 'blob'

**useApi.ts** -- Add these hooks:

useBazarrMappingReport() -> useMutation wrapping getBazarrMappingReport
useCompatCheck() -> useMutation wrapping runCompatCheck
useExtendedHealthAll() -> useQuery with queryKey ['extended-health-all'] calling getExtendedHealthAll, enabled: false (manual trigger)
useExportConfig() -> useMutation wrapping exportConfig
useExportConfigZip() -> useMutation wrapping exportConfigZip
  </action>
  <verify>
Run: cd frontend and npx tsc --noEmit -- no type errors related to the new types/functions.
  </verify>
  <done>TypeScript interfaces for all integration responses defined. API client has 6 new functions. useApi has 5 new hooks for integration features.</done>
</task>

<task type="auto">
  <name>Task 2: Create IntegrationsTab component and integrate into Settings</name>
  <files>
    frontend/src/pages/Settings/IntegrationsTab.tsx
    frontend/src/pages/Settings/index.tsx
    frontend/src/i18n/locales/en/settings.json
    frontend/src/i18n/locales/de/settings.json
  </files>
  <action>
**IntegrationsTab.tsx** -- Create a new component exported as { IntegrationsTab }.

Structure the tab with 4 collapsible sections (reuse the collapsible pattern from CleanupTab/AdvancedTab):

Section 1: Bazarr Migration
- Text input for Bazarr DB path.
- "Generate Mapping Report" button triggers useBazarrMappingReport mutation.
- Display results in a structured view:
  - Compatibility info (Bazarr version, schema version).
  - Migration summary (counts for profiles, blacklist, shows, movies, history, sonarr/radarr config).
  - Table inventory (collapsible list of tables with row counts).
  - Warnings list.
- "Proceed to Import" button links to existing Bazarr import flow in ApiKeysTab (do not duplicate import logic here -- just reference it).

Section 2: Compatibility Check
- Dropdown to select target: Plex or Kodi.
- Text input for video file path.
- Text area for subtitle paths (one per line).
- "Run Check" button triggers useCompatCheck mutation.
- Display results as a list of cards, each showing:
  - File path with green checkmark or red X icon.
  - Issues list (red text).
  - Warnings list (amber text).
  - Recommendations list (blue text).
- Summary bar at top: "X/Y compatible".

Section 3: Extended Health Diagnostics
- "Run Diagnostics" button triggers useExtendedHealthAll query refetch.
- Display results grouped by service type (Sonarr, Radarr, Jellyfin/Emby, Media Servers).
- For each service instance, show a card with:
  - Connection status (green/red badge).
  - Version info.
  - Library access summary.
  - Webhook status (Sonarr/Radarr only).
  - Health issues list (if any, amber/red badges).

Section 4: Export Configuration
- Dropdown to select format: Bazarr Compatible, Plex Manifest, Kodi, Generic JSON.
- Checkbox: "Include secrets" (default unchecked, with warning text).
- "Export" button triggers useExportConfig mutation. On success, trigger browser download of the JSON response as a file.
- "Export All (ZIP)" button triggers useExportConfigZip mutation. On success, trigger browser download of the blob as a .zip file.
- Note text: "Generic JSON is the recommended primary export format."

Use lucide-react icons: FileJson, Shield, Heart, Download, CheckCircle, XCircle, AlertTriangle.
Use Tailwind classes consistent with existing Settings tabs (teal accents, dark theme compatible).

**Settings/index.tsx** -- Add IntegrationsTab:
1. Import: import { IntegrationsTab } from './IntegrationsTab'
2. Add 'Integrations' to TABS array (after 'Cleanup', before 'Notification Templates' or at the end).
3. Add the tab rendering case in the tab content switch/conditional.

**i18n/locales/en/settings.json** -- Add keys under a new "integrations" section:
- integrations.title: "Integrations"
- integrations.bazarr.title: "Bazarr Migration"
- integrations.bazarr.dbPath: "Bazarr Database Path"
- integrations.bazarr.dbPathHelp: "Path to your Bazarr SQLite database file (bazarr.db)"
- integrations.bazarr.generateReport: "Generate Mapping Report"
- integrations.bazarr.reportTitle: "Mapping Report"
- integrations.bazarr.compatibility: "Compatibility"
- integrations.bazarr.summary: "Migration Summary"
- integrations.bazarr.tables: "Database Tables"
- integrations.bazarr.proceedToImport: "Proceed to Import"
- integrations.compat.title: "Compatibility Check"
- integrations.compat.target: "Target Player"
- integrations.compat.videoPath: "Video File Path"
- integrations.compat.subtitlePaths: "Subtitle File Paths (one per line)"
- integrations.compat.runCheck: "Run Check"
- integrations.compat.compatible: "compatible"
- integrations.compat.incompatible: "incompatible"
- integrations.health.title: "Extended Health Diagnostics"
- integrations.health.runDiagnostics: "Run Diagnostics"
- integrations.health.connection: "Connection"
- integrations.health.version: "Version"
- integrations.health.libraryAccess: "Library Access"
- integrations.health.webhookStatus: "Webhook Status"
- integrations.health.healthIssues: "Health Issues"
- integrations.health.noIssues: "No issues detected"
- integrations.export.title: "Export Configuration"
- integrations.export.format: "Export Format"
- integrations.export.includeSecrets: "Include secrets (API keys, passwords)"
- integrations.export.secretsWarning: "Warning: exported file will contain sensitive credentials"
- integrations.export.export: "Export"
- integrations.export.exportAll: "Export All (ZIP)"
- integrations.export.recommended: "Generic JSON is the recommended primary export format"
- integrations.export.bazarrNote: "Bazarr-compatible format (not guaranteed exact match)"

**i18n/locales/de/settings.json** -- Add German translations for all the above keys:
- integrations.title: "Integrationen"
- integrations.bazarr.title: "Bazarr Migration"
- integrations.bazarr.dbPath: "Bazarr Datenbankpfad"
- integrations.bazarr.dbPathHelp: "Pfad zur Bazarr SQLite-Datenbankdatei (bazarr.db)"
- integrations.bazarr.generateReport: "Zuordnungsbericht erstellen"
- integrations.bazarr.reportTitle: "Zuordnungsbericht"
- integrations.bazarr.compatibility: "Kompatibilitaet"
- integrations.bazarr.summary: "Migrations-Zusammenfassung"
- integrations.bazarr.tables: "Datenbanktabellen"
- integrations.bazarr.proceedToImport: "Weiter zum Import"
- integrations.compat.title: "Kompatibilitaetspruefung"
- integrations.compat.target: "Ziel-Player"
- integrations.compat.videoPath: "Video-Dateipfad"
- integrations.compat.subtitlePaths: "Untertitel-Dateipfade (einer pro Zeile)"
- integrations.compat.runCheck: "Pruefung starten"
- integrations.compat.compatible: "kompatibel"
- integrations.compat.incompatible: "inkompatibel"
- integrations.health.title: "Erweiterte Gesundheitsdiagnostik"
- integrations.health.runDiagnostics: "Diagnose starten"
- integrations.health.connection: "Verbindung"
- integrations.health.version: "Version"
- integrations.health.libraryAccess: "Bibliothekszugriff"
- integrations.health.webhookStatus: "Webhook-Status"
- integrations.health.healthIssues: "Probleme"
- integrations.health.noIssues: "Keine Probleme erkannt"
- integrations.export.title: "Konfiguration exportieren"
- integrations.export.format: "Exportformat"
- integrations.export.includeSecrets: "Geheimnisse einschliessen (API-Schluessel, Passwoerter)"
- integrations.export.secretsWarning: "Warnung: Die exportierte Datei enthaelt sensible Zugangsdaten"
- integrations.export.export: "Exportieren"
- integrations.export.exportAll: "Alle exportieren (ZIP)"
- integrations.export.recommended: "Generisches JSON ist das empfohlene primaere Exportformat"
- integrations.export.bazarrNote: "Bazarr-kompatibles Format (keine Garantie fuer exakte Uebereinstimmung)"
  </action>
  <verify>
Run: cd frontend and npx tsc --noEmit -- no type errors.
Run: cd frontend and npm run build -- builds successfully.
Verify IntegrationsTab appears in Settings tab list.
  </verify>
  <done>IntegrationsTab with 4 sections (Bazarr Migration, Compatibility Check, Extended Health, Export) renders in Settings. All text internationalized in EN and DE. Tab integrates with backend API via hooks.</done>
</task>

</tasks>

<verification>
- IntegrationsTab renders in Settings page.
- TypeScript compiles without errors.
- Frontend build succeeds.
- All 4 sections visible and functional (Bazarr, Compat, Health, Export).
- i18n keys present in both en and de locale files.
</verification>

<success_criteria>
- User can navigate to Settings > Integrations tab.
- Bazarr mapping report generates and displays from a DB path.
- Compatibility check validates subtitle paths against Plex/Kodi conventions.
- Extended health diagnostics show structured results for all services.
- Export produces downloadable files in all 4 formats plus ZIP bundle.
- All UI text available in English and German.
</success_criteria>

<output>
After completion, create .planning/phases/16-external-integrations/16-03-SUMMARY.md
</output>
